# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üìã –ß—Ç–æ –≥–æ—Ç–æ–≤–æ

‚úÖ **49 —Ç–µ—Å—Ç–æ–≤** –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã  
‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ñ–∞–±—Ä–∏–∫–∏** –¥–ª—è SQLite-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö –º–æ–¥–µ–ª–µ–π  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ** PostgreSQL —Ç–∏–ø–æ–≤  
‚úÖ **100% –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ** —Ç–µ—Å—Ç–æ–≤ –∑–∞ ~9 —Å–µ–∫—É–Ω–¥  

## üèÉ‚Äç‚ôÇÔ∏è –ó–∞–ø—É—Å–∫ –∑–∞ 30 —Å–µ–∫—É–Ω–¥

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
cd app
pip install -r tests/requirements.txt
```

### 2. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```bash
cd tests
python -m pytest -v
```

### 3. –†–µ–∑—É–ª—å—Ç–∞—Ç
```
==================================== 49 passed, 98 warnings in 9.14s ======================================
```

## üéØ –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (8 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- ‚úÖ –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π  
- ‚úÖ –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- ‚úÖ –°–≤—è–∑–∏ —Å –∫–æ—à–µ–ª—å–∫–æ–º

### –ö–æ—à–µ–ª–µ–∫ (11 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–∞–Ω—Å–æ–º
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–≤—è–∑–∏ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏

### –§–∏–ª—å–º—ã (10 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ ARRAY –ø–æ–ª—è (–∂–∞–Ω—Ä—ã)
- ‚úÖ Vector –ø–æ–ª—è (—ç–º–±–µ–¥–¥–∏–Ω–≥–∏)
- ‚úÖ JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (13 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ –ü–æ–ª–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- ‚úÖ –°–≤—è–∑–∏ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –º–æ–¥–µ–ª—è–º–∏
- ‚úÖ –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã –æ–±—ä–µ–∫—Ç–æ–≤

### –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (7 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ –†–∞–±–æ—Ç–∞ —Ñ–∏–∫—Å—Ç—É—Ä
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫-–æ–±—ä–µ–∫—Ç–æ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –§–∞–±—Ä–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π
```python
# simple_factory.py –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç SQLite-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –º–æ–¥–µ–ª–∏
TestUser = SimpleTestModelFactory._create_test_user()
TestMovie = SimpleTestModelFactory._create_test_movie()
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤
```python
# PostgreSQL ‚Üí SQLite
ARRAY(String) ‚Üí str (JSON)  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
Vector(384) ‚Üí str (JSON)    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

# –í —Ç–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–π—Å—Ç–≤–∞
movie.genres_list      # –ü–æ–ª—É—á–∏—Ç—å –∂–∞–Ω—Ä—ã –∫–∞–∫ —Å–ø–∏—Å–æ–∫
movie.embedding_vector # –ü–æ–ª—É—á–∏—Ç—å —ç–º–±–µ–¥–∏–Ω–≥ –∫–∞–∫ –≤–µ–∫—Ç–æ—Ä
```

### –ò–∑–æ–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
```python
# –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–µ–∂—É—é SQLite in-memory –ë–î
@pytest.fixture(name="session")
def session_fixture():
    SQLModel.metadata.drop_all(engine)      # –û—á–∏—Å—Ç–∫–∞
    SQLModel.metadata.create_all(engine)    # –°–æ–∑–¥–∞–Ω–∏–µ
```

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
```bash
# –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
python -m pytest test_user_operations.py -v

# –¢–æ–ª—å–∫–æ –∫–æ—à–µ–ª–µ–∫  
python -m pytest test_wallet_operations.py -v

# –¢–æ–ª—å–∫–æ —Ñ–∏–ª—å–º—ã
python -m pytest test_movie_recommendations.py -v

# –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
python -m pytest test_integration_scenarios.py -v
```

### –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
```bash
python -m pytest --cov=app --cov-report=html
```

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
```bash
python run_tests.py
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/tests/
‚îú‚îÄ‚îÄ conftest.py                  # ‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ simple_factory.py            # üè≠ –§–∞–±—Ä–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π
‚îú‚îÄ‚îÄ adapters.py                  # üîå –ê–¥–∞–ø—Ç–µ—Ä—ã PostgreSQL —Ç–∏–ø–æ–≤
‚îú‚îÄ‚îÄ fix_test_values.py           # üõ†Ô∏è –£—Ç–∏–ª–∏—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ requirements.txt             # üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ pytest.ini                  # ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
‚îú‚îÄ‚îÄ run_tests.py                 # üöÄ –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ README.md                    # üìñ –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ TESTS_SUMMARY.md             # üìä –ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä
‚îú‚îÄ‚îÄ ARCHITECTURE.md              # üèóÔ∏è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
‚îî‚îÄ‚îÄ test_*.py                    # üß™ –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
```

## üé® –§–∏–∫—Å—Ç—É—Ä—ã

### –ë–∞–∑–æ–≤—ã–µ
```python
@pytest.fixture(name="session")           # SQLite —Å–µ—Å—Å–∏—è
@pytest.fixture(name="client")            # FastAPI –∫–ª–∏–µ–Ω—Ç
@pytest.fixture(name="db_session")        # –ê–ª–∏–∞—Å –¥–ª—è session
```

### –î–∞–Ω–Ω—ã–µ
```python
@pytest.fixture(name="mock_user_data")    # –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
@pytest.fixture(name="mock_movie_data")   # –î–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å–º–∞ (—Å ARRAY/Vector)
```

### –û–±—ä–µ–∫—Ç—ã
```python
@pytest.fixture(name="mock_user")         # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–±–∞–ª–∞–Ω—Å 0.0)
@pytest.fixture(name="mock_admin_user")   # –ê–¥–º–∏–Ω (–±–∞–ª–∞–Ω—Å 1000.0)
@pytest.fixture(name="mock_movie")        # –§–∏–ª—å–º —Å JSON –ø–æ–ª—è–º–∏
@pytest.fixture(name="mock_transaction")  # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 100.0 DEPOSIT
@pytest.fixture(name="mock_prediction")   # –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é 5.0
```

## üîç –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

### –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```python
def test_user_model_creation(self, mock_user):
    """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    assert mock_user.email == "test@example.com"
    assert mock_user.is_admin is False
    assert hasattr(mock_user, 'wallet')
```

### –¢–µ—Å—Ç ARRAY –ø–æ–ª–µ–π
```python
def test_movie_array_field_emulation(self, mock_movie):
    """–¢–µ—Å—Ç —ç–º—É–ª—è—Ü–∏–∏ –ø–æ–ª—è ARRAY –≤ –º–æ–¥–µ–ª–∏ —Ñ–∏–ª—å–º–∞"""
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∂–∞–Ω—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ JSON —Å—Ç—Ä–æ–∫–∞
    assert isinstance(mock_movie.genres, str)
    assert mock_movie.genres.startswith('[')
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∂–∞–Ω—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ —Å–ø–∏—Å–æ–∫
    genres_list = mock_movie.genres_list
    assert isinstance(genres_list, list)
    assert "action" in genres_list
```

### –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
```python
def test_user_wallet_transaction_chain(self, mock_user, mock_transaction):
    """–¢–µ—Å—Ç —Ü–µ–ø–æ—á–∫–∏ —Å–≤—è–∑–µ–π: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –∫–æ—à–µ–ª–µ–∫ ‚Üí —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è"""
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª–Ω—É—é —Ü–µ–ø–æ—á–∫—É —Å–≤—è–∑–µ–π
    assert mock_user.wallet.user_id == mock_user.id
    assert mock_transaction.user_id == mock_user.id
    assert mock_transaction.wallet_id == mock_user.wallet.id
```

## üö® Troubleshooting

### –û—à–∏–±–∫–∏ —Å —Ç–∏–ø–∞–º–∏ PostgreSQL
```bash
‚ùå ARRAY has no matching SQLAlchemy type
‚úÖ –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∞–±—Ä–∏–∫–∞ –º–æ–¥–µ–ª–µ–π
```

### –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ SQLModel
```bash
‚ùå "TestUser" object has no field "wallet"
‚úÖ –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è object.__setattr__ –¥–ª—è –æ–±—Ö–æ–¥–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∏–∫—Å—Ç—É—Ä–∞–º–∏
```bash
‚ùå Fixture not used
‚úÖ –†–µ—à–µ–Ω–∏–µ: –í—Å–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ç–µ—Å—Ç–∞—Ö
```

### –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
‚ùå –¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è > 10 —Å–µ–∫—É–Ω–¥
‚úÖ –†–µ—à–µ–Ω–∏–µ: SQLite in-memory –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[README.md](README.md)** - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- **[TESTS_SUMMARY.md](TESTS_SUMMARY.md)** - –ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- **[ARCHITECTURE.md](ARCHITECTURE.md)** - –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò–∑—É—á–∏—Ç–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** - –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ `ARCHITECTURE.md`
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã** - —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. **–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞–∫ –ø—Ä–∏–º–µ—Ä—ã
4. **–†–∞—Å—à–∏—Ä—å—Ç–µ —Ñ–∞–±—Ä–∏–∫—É** - –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!

–°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∏ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –ª–µ–≥–∫–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: ~9 —Å–µ–∫—É–Ω–¥ –¥–ª—è 49 —Ç–µ—Å—Ç–æ–≤  
**–ü–æ–∫—Ä—ã—Ç–∏–µ**: 100% –∫–ª—é—á–µ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π  
**–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –æ—à–∏–±–æ–∫  

–£–¥–∞—á–∏ –≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏! üéâ
