# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Ñ–∏–ª—å–º–æ–≤

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Factory Pattern** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è SQLite-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö –≤–µ—Ä—Å–∏–π SQLModel –º–æ–¥–µ–ª–µ–π. –≠—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ PostgreSQL —Ç–∏–ø–æ–≤ (`ARRAY`, `Vector`) —Å SQLite.

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: 49 —Ç–µ—Å—Ç–æ–≤, 100% –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ, ~9 —Å–µ–∫—É–Ω–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –§–∞–±—Ä–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π
```python
# simple_factory.py –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç SQLite-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –º–æ–¥–µ–ª–∏
TestUser = SimpleTestModelFactory._create_test_user()
TestMovie = SimpleTestModelFactory._create_test_movie()
```

### –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- `ARRAY(String)` ‚Üí `str` (JSON —Å—Ç—Ä–æ–∫–∞) 
- `Vector(384)` ‚Üí `str` (JSON —Å—Ç—Ä–æ–∫–∞)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
app/tests/
‚îú‚îÄ‚îÄ conftest.py                  # –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ simple_factory.py            # –§–∞–±—Ä–∏–∫–∞ SQLite-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö –º–æ–¥–µ–ª–µ–π
‚îú‚îÄ‚îÄ adapters.py                  # –ê–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è PostgreSQL —Ç–∏–ø–æ–≤
‚îú‚îÄ‚îÄ requirements.txt             # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ pytest.ini                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
‚îú‚îÄ‚îÄ run_tests.py                 # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ README.md                    # üìñ –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ test_*.py                    # –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
cd app
pip install -r tests/requirements.txt
```

### –ó–∞–ø—É—Å–∫
```bash
cd tests
python -m pytest -v
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç
```
==================================== 49 passed, 98 warnings in 9.14s ======================================
```

## üéØ –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (8 —Ç–µ—Å—Ç–æ–≤)
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π —Å bcrypt
- –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –°–≤—è–∑–∏ —Å –∫–æ—à–µ–ª—å–∫–æ–º –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

### –ö–æ—à–µ–ª–µ–∫ (11 —Ç–µ—Å—Ç–æ–≤)
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–∞–Ω—Å–æ–º
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –°–≤—è–∑–∏ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –∫–æ—à–µ–ª—å–∫–æ–º –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

### –§–∏–ª—å–º—ã (10 —Ç–µ—Å—Ç–æ–≤)
- –≠–º—É–ª—è—Ü–∏—è PostgreSQL ARRAY –∏ Vector —Ç–∏–ø–æ–≤
- JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (13 —Ç–µ—Å—Ç–æ–≤)
- –ü–æ–ª–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- –°–≤—è–∑–∏ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –º–æ–¥–µ–ª—è–º–∏
- –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (7 —Ç–µ—Å—Ç–æ–≤)
- –†–∞–±–æ—Ç–∞ —Ñ–∏–∫—Å—Ç—É—Ä
- –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫-–æ–±—ä–µ–∫—Ç–æ–≤

## üîß –§–∏–∫—Å—Ç—É—Ä—ã

### –ë–∞–∑–æ–≤—ã–µ
- `session` - SQLite —Å–µ—Å—Å–∏—è –ë–î
- `client` - —Ç–µ—Å—Ç–æ–≤—ã–π FastAPI –∫–ª–∏–µ–Ω—Ç
- `db_session` - –∞–ª–∏–∞—Å –¥–ª—è session

### –î–∞–Ω–Ω—ã–µ
- `mock_user_data` - –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `mock_movie_data` - –¥–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å–º–∞ (—Å ARRAY –∏ Vector)

### –û–±—ä–µ–∫—Ç—ã
- `mock_user` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –∫–æ—à–µ–ª—å–∫–æ–º (–±–∞–ª–∞–Ω—Å 0.0)
- `mock_admin_user` - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å –∫–æ—à–µ–ª—å–∫–æ–º (–±–∞–ª–∞–Ω—Å 1000.0)
- `mock_movie` - —Ñ–∏–ª—å–º —Å JSON-—Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
- `mock_transaction` - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞ 100.0 —Ç–∏–ø–∞ "DEPOSIT"
- `mock_prediction` - –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é 5.0

## üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

### –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```python
def test_user_model_creation(self, mock_user):
    """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    assert mock_user.email == "test@example.com"
    assert mock_user.is_admin is False
    assert hasattr(mock_user, 'wallet')
```

### –¢–µ—Å—Ç ARRAY –ø–æ–ª–µ–π
```python
def test_movie_array_field_emulation(self, mock_movie):
    """–¢–µ—Å—Ç —ç–º—É–ª—è—Ü–∏–∏ –ø–æ–ª—è ARRAY –≤ –º–æ–¥–µ–ª–∏ —Ñ–∏–ª—å–º–∞"""
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∂–∞–Ω—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ JSON —Å—Ç—Ä–æ–∫–∞
    assert isinstance(mock_movie.genres, str)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∂–∞–Ω—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ —Å–ø–∏—Å–æ–∫
    genres_list = mock_movie.genres_list
    assert isinstance(genres_list, list)
    assert "action" in genres_list
```

## üîç Troubleshooting

### –û—à–∏–±–∫–∏ —Å —Ç–∏–ø–∞–º–∏ PostgreSQL
‚ùå `ARRAY has no matching SQLAlchemy type`  
‚úÖ **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∞–±—Ä–∏–∫–∞ –º–æ–¥–µ–ª–µ–π

### –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ SQLModel
‚ùå `"TestUser" object has no field "wallet"`  
‚úÖ **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `object.__setattr__` –¥–ª—è –æ–±—Ö–æ–¥–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚ùå –¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è > 10 —Å–µ–∫—É–Ω–¥  
‚úÖ **–†–µ—à–µ–Ω–∏–µ**: SQLite in-memory –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

## üìö –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏
1. –°–æ–∑–¥–∞–π—Ç–µ –º–æ–¥–µ–ª—å –≤ `app/models/`
2. –î–æ–±–∞–≤—å—Ç–µ –≤ `SimpleTestModelFactory.create_test_models()`
3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∏–∫—Å—Ç—É—Ä—É –≤ `conftest.py`
4. –ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ—Å—Ç—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö
1. –°–æ–∑–¥–∞–π—Ç–µ –∞–¥–∞–ø—Ç–µ—Ä –≤ `adapters.py`
2. –û–±–Ω–æ–≤–∏—Ç–µ `_map_field_type()` –≤ —Ñ–∞–±—Ä–∏–∫–µ
3. –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏–∫—É –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ `__init__`

## üéâ –ì–æ—Ç–æ–≤–æ!

–°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π —Ñ–∞–±—Ä–∏–∫–∏ –º–æ–¥–µ–ª–µ–π. –í—Å–µ 49 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞ ~9 —Å–µ–∫—É–Ω–¥, –ø–æ–∫—Ä—ã–≤–∞—è 100% –∫–ª—é—á–µ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å–∏—Å—Ç–µ–º—ã.