# ๐๏ธ ะััะธัะตะบัััะฐ ML ัะตัะฒะธัะฐ ัะตะบะพะผะตะฝะดะฐัะธะน ัะธะปัะผะพะฒ

## ๐ ะะฑะทะพั ัะธััะตะผั

ML ัะตัะฒะธั ะฟัะตะดััะฐะฒะปัะตั ัะพะฑะพะน ะผะธะบัะพัะตัะฒะธัะฝัั ะฐััะธัะตะบัััั, ัะพััะพัััั ะธะท ะฝะตัะบะพะปัะบะธั ะบะพะฝัะตะนะฝะตัะพะฒ, ะบะฐะถะดัะน ะธะท ะบะพัะพััั ะพัะฒะตัะฐะตั ะทะฐ ะพะฟัะตะดะตะปะตะฝะฝัั ััะฝะบัะธะพะฝะฐะปัะฝะพััั. ะกะธััะตะผะฐ ะฟะพัััะพะตะฝะฐ ะฝะฐ ะฟัะธะฝัะธะฟะฐั ัะฐะทะดะตะปะตะฝะธั ะพัะฒะตัััะฒะตะฝะฝะพััะธ, ะผะฐัััะฐะฑะธััะตะผะพััะธ ะธ ะพัะบะฐะทะพัััะพะนัะธะฒะพััะธ.

## ๐ณ ะััะธัะตะบัััะฐ ะบะพะฝัะตะนะฝะตัะพะฒ

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   Web Browser  โ    โ   Mobile App    โ    โ  Telegram Bot   โ
โโโโโโโโโโโฌโโโโโโโโ    โโโโโโโโโโโฌโโโโโโโโ    โโโโโโโโโโโฌโโโโโโโโ
          โ                      โ                      โ
          โโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                    โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
                    โ      Nginx (Port 80)      โ
                    โ     (Reverse Proxy)       โ
                    โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
                                  โ
                    โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
                    โ    FastAPI App (Port 8000)โ
                    โ   (Main Application)      โ
                    โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
                                  โ
          โโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโ
          โ                       โ                       โ
โโโโโโโโโโโผโโโโโโโโโโ  โโโโโโโโโโโผโโโโโโโโโโ  โโโโโโโโโโโผโโโโโโโโโโ
โ   PostgreSQL      โ  โ     RabbitMQ      โ  โ   ML Worker      โ
โ   (Port 5432)     โ  โ   (Port 5672)     โ  โ   (Port 8001)    โ
โ   + pgvector      โ  โ   + Management    โ  โ   (ML Service)   โ
โโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโ
```

## ๐ง ะัะฝะพะฒะฝัะต ะบะพะผะฟะพะฝะตะฝัั

### 1. **Nginx (web-proxy)**
- **ะะพะปั**: ะะฑัะฐัะฝัะน ะฟัะพะบัะธ-ัะตัะฒะตั
- **ะะพัั**: 80 (HTTP)
- **ะคัะฝะบัะธะธ**:
  - ะะฐัััััะธะทะฐัะธั ะทะฐะฟัะพัะพะฒ ะบ FastAPI ะฟัะธะปะพะถะตะฝะธั
  - ะกัะฐัะธัะตัะบะพะต ะพะฑัะปัะถะธะฒะฐะฝะธะต ัะฐะนะปะพะฒ
  - ะะฐะปะฐะฝัะธัะพะฒะบะฐ ะฝะฐะณััะทะบะธ (ะณะพัะพะฒะฝะพััั ะบ ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธั)
  - SSL termination (ะฒ production)

### 2. **FastAPI App (app)**
- **ะะพะปั**: ะัะฝะพะฒะฝะพะต ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะต
- **ะะพัั**: 8000
- **ะคัะฝะบัะธะธ**:
  - REST API endpoints
  - Web UI (HTML ัััะฐะฝะธัั)
  - ะััะตะฝัะธัะธะบะฐัะธั ะธ ะฐะฒัะพัะธะทะฐัะธั
  - ะะธะทะฝะตั-ะปะพะณะธะบะฐ
  - ะะฝัะตะณัะฐัะธั ั ะฑะฐะทะพะน ะดะฐะฝะฝัั
  - RPC ะบะปะธะตะฝั ะดะปั ML ัะตัะฒะธัะฐ

### 3. **PostgreSQL (database)**
- **ะะพะปั**: ะัะฝะพะฒะฝะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั
- **ะะพัั**: 5432
- **ะะฐััะธัะตะฝะธั**: pgvector ะดะปั ะฒะตะบัะพัะฝัั ะพะฟะตัะฐัะธะน
- **ะคัะฝะบัะธะธ**:
  - ะฅัะฐะฝะตะฝะธะต ะดะฐะฝะฝัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
  - ะฅัะฐะฝะตะฝะธะต ะธะฝัะพัะผะฐัะธะธ ะพ ัะธะปัะผะฐั
  - ะะตะบัะพัะฝัะต ัะผะฑะตะดะดะธะฝะณะธ ัะธะปัะผะพะฒ
  - ะััะพัะธั ะฟัะตะดัะบะฐะทะฐะฝะธะน
  - ะขัะฐะฝะทะฐะบัะธะธ ะธ ะฑะฐะปะฐะฝัั

### 4. **RabbitMQ (rabbitmq)**
- **ะะพะปั**: Message broker ะดะปั RPC
- **ะะพัั**: 5672 (AMQP), 15672 (Management UI)
- **ะคัะฝะบัะธะธ**:
  - RPC ะบะพะผะผัะฝะธะบะฐัะธั ะผะตะถะดั app ะธ ml_worker
  - ะัะตัะตะดั ัะพะพะฑัะตะฝะธะน ะดะปั ะฐัะธะฝััะพะฝะฝะพะน ะพะฑัะฐะฑะพัะบะธ
  - ะฃะฟัะฐะฒะปะตะฝะธะต ัะตัะตะท ะฒะตะฑ-ะธะฝัะตััะตะนั

### 5. **ML Worker (ml_worker)**
- **ะะพะปั**: ML ัะตัะฒะธั ะดะปั ะณะตะฝะตัะฐัะธะธ ัะผะฑะตะดะดะธะฝะณะพะฒ
- **ะะพัั**: 8001 (ะฒะฝัััะตะฝะฝะธะน)
- **ะคัะฝะบัะธะธ**:
  - ะะตะฝะตัะฐัะธั ะฒะตะบัะพัะฝัั ัะผะฑะตะดะดะธะฝะณะพะฒ
  - ะะฑัะฐะฑะพัะบะฐ ัะตะบััะพะฒัั ะทะฐะฟัะพัะพะฒ
  - ML ะผะพะดะตะปะธ (Sentence Transformers)

## ๐ ะะพัะพะบะธ ะดะฐะฝะฝัั

### 1. **ะะฐะฟัะพั ัะตะบะพะผะตะฝะดะฐัะธะน**
```
User โ Nginx โ FastAPI โ RabbitMQ โ ML Worker โ FastAPI โ Database โ User
```

1. ะะพะปัะทะพะฒะฐัะตะปั ะพัะฟัะฐะฒะปัะตั ะทะฐะฟัะพั ัะตัะตะท Web UI
2. Nginx ะฟัะพะบัะธััะตั ะทะฐะฟัะพั ะบ FastAPI ะฟัะธะปะพะถะตะฝะธั
3. FastAPI ะฟัะพะฒะตััะตั ะฐะฒัะพัะธะทะฐัะธั ะธ ะฑะฐะปะฐะฝั ะฟะพะปัะทะพะฒะฐัะตะปั
4. ะะฐะฟัะพั ะพัะฟัะฐะฒะปัะตััั ะฒ RabbitMQ ะดะปั ML Worker
5. ML Worker ะณะตะฝะตัะธััะตั ัะผะฑะตะดะดะธะฝะณ ะทะฐะฟัะพัะฐ
6. FastAPI ะฒัะฟะพะปะฝัะตั ะฒะตะบัะพัะฝัะน ะฟะพะธัะบ ะฒ ะฑะฐะทะต ะดะฐะฝะฝัั
7. ะะตะทัะปััะฐัั ะฒะพะทะฒัะฐัะฐัััั ะฟะพะปัะทะพะฒะฐัะตะปั

### 2. **ะะตะณะธัััะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปั**
```
User โ Nginx โ FastAPI โ Database โ User
```

1. ะะพะปัะทะพะฒะฐัะตะปั ะทะฐะฟะพะปะฝัะตั ัะพัะผั ัะตะณะธัััะฐัะธะธ
2. FastAPI ะฒะฐะปะธะดะธััะตั ะดะฐะฝะฝัะต (email, ะฟะฐัะพะปั)
3. ะกะพะทะดะฐะตััั ะฟะพะปัะทะพะฒะฐัะตะปั ะฒ ะฑะฐะทะต ะดะฐะฝะฝัั
4. ะกะพะทะดะฐะตััั ะบะพัะตะปะตะบ ั ะฝะฐัะฐะปัะฝัะผ ะฑะพะฝััะพะผ
5. ะะพะทะฒัะฐัะฐะตััั ะฟะพะดัะฒะตัะถะดะตะฝะธะต

### 3. **ะะฐะณััะทะบะฐ ัะธะปัะผะพะฒ**
```
System โ FastAPI โ ML Worker โ Database
```

1. ะัะธ ะทะฐะฟััะบะต ัะธััะตะผั ัะบะฐะฝะธัััััั JSON ัะฐะนะปั
2. ะะปั ะบะฐะถะดะพะณะพ ัะธะปัะผะฐ ะณะตะฝะตัะธััะตััั ัะผะฑะตะดะดะธะฝะณ
3. ะะฐะฝะฝัะต ัะพััะฐะฝััััั ะฒ ะฑะฐะทั ั ะฒะตะบัะพัะฝัะผะธ ะฟัะตะดััะฐะฒะปะตะฝะธัะผะธ

## ๐๏ธ ะะพะดะตะปะธ ะดะฐะฝะฝัั

### Core Entities

```mermaid
erDiagram
    User ||--|| Wallet : has
    User ||--o{ Prediction : makes
    User ||--o{ Transaction : performs
    Wallet ||--o{ Transaction : contains
    Prediction ||--o{ PredictionMovieLink : includes
    Movie ||--o{ PredictionMovieLink : appears_in
```

### 1. **User**
- ะัะฝะพะฒะฝะฐั ัััะฝะพััั ะฟะพะปัะทะพะฒะฐัะตะปั
- ะกะพะดะตัะถะธั email, ัะตั ะฟะฐัะพะปั, ัะปะฐะณ ะฐะดะผะธะฝะธัััะฐัะพัะฐ
- ะกะฒัะทะฐะฝ ั ะบะพัะตะปัะบะพะผ ะธ ะฟัะตะดัะบะฐะทะฐะฝะธัะผะธ

### 2. **Wallet**
- ะฃะฟัะฐะฒะปะตะฝะธะต ะฑะฐะปะฐะฝัะพะผ ะฟะพะปัะทะพะฒะฐัะตะปั
- ะกะฒัะทะฐะฝ ั ััะฐะฝะทะฐะบัะธัะผะธ
- ะะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐะตััั ะฟัะธ ัะตะณะธัััะฐัะธะธ

### 3. **Movie**
- ะะฝัะพัะผะฐัะธั ะพ ัะธะปัะผะฐั
- ะะบะปััะฐะตั ะฒะตะบัะพัะฝัะต ัะผะฑะตะดะดะธะฝะณะธ (384-ะผะตัะฝัะต)
- ะะพะดะดะตัะถะธะฒะฐะตั ะผะฝะพะณะพัะทััะฝัะต ะพะฟะธัะฐะฝะธั

### 4. **Prediction**
- ะััะพัะธั ะทะฐะฟัะพัะพะฒ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- ะกะพะดะตัะถะธั ะธััะพะดะฝัะน ัะตะบัั ะธ ัะตะทัะปััะฐัั
- ะกะฒัะทะฐะฝ ั ัะธะปัะผะฐะผะธ ัะตัะตะท ัะฒัะทััััั ัะฐะฑะปะธัั

### 5. **Transaction**
- ะะฐะฟะธัะธ ะฒัะตั ัะธะฝะฐะฝัะพะฒัั ะพะฟะตัะฐัะธะน
- ะขะธะฟั: deposit, withdrawal, prediction, admin_adjustment
- ะััะปะตะถะธะฒะฐะฝะธะต ะธะทะผะตะฝะตะฝะธะน ะฑะฐะปะฐะฝัะฐ

## ๐ ะกะธััะตะผะฐ ะฑะตะทะพะฟะฐัะฝะพััะธ

### ะััะตะฝัะธัะธะบะฐัะธั
- **HTTP Basic Auth** ะดะปั API endpoints
- ะะฐะปะธะดะฐัะธั ัะปะพะถะฝะพััะธ ะฟะฐัะพะปะตะน
- Rate limiting ะดะปั ะฟัะตะดะพัะฒัะฐัะตะฝะธั ะฑััััะพััะฐ

### ะะฒัะพัะธะทะฐัะธั
- ะะฐัะธัะตะฝะฝัะต endpoint'ั ะดะปั ะบัะธัะธัะฝัั ะพะฟะตัะฐัะธะน
- ะัะพะฒะตัะบะฐ ะฟัะฐะฒ ะดะพัััะฟะฐ ะบ ัะตััััะฐะผ
- ะะฐะทะดะตะปะตะฝะธะต ัะพะปะตะน (ะฟะพะปัะทะพะฒะฐัะตะปั/ะฐะดะผะธะฝะธัััะฐัะพั)

### Security Middleware
- Security headers (XSS, CSRF ะทะฐัะธัะฐ)
- Trusted Host validation
- CORS ั ะพะณัะฐะฝะธัะตะฝะฝัะผะธ origins
- ะะพะณะธัะพะฒะฐะฝะธะต ะฑะตะทะพะฟะฐัะฝะพััะธ

## ๐ก API Architecture

### REST Endpoints
```
/api/
โโโ / (root) - ะธะฝัะพัะผะฐัะธั ะพ ัะตัะฒะธัะต
โโโ /health - ะฟัะพะฒะตัะบะฐ ัะพััะพัะฝะธั
โโโ /users/
โ   โโโ /signup - ัะตะณะธัััะฐัะธั
โ   โโโ /signin - ะฐััะตะฝัะธัะธะบะฐัะธั
โ   โโโ /balance - ะฟะพะปััะตะฝะธะต ะฑะฐะปะฐะฝัะฐ
โ   โโโ /balance/adjust - ะธะทะผะตะฝะตะฝะธะต ะฑะฐะปะฐะฝัะฐ
โ   โโโ /transaction/history - ะธััะพัะธั ััะฐะฝะทะฐะบัะธะน
โโโ /events/
    โโโ /prediction/history - ะธััะพัะธั ะฟัะตะดัะบะฐะทะฐะฝะธะน
    โโโ /prediction/new - ะฝะพะฒัะต ะฟัะตะดัะบะฐะทะฐะฝะธั
```

### Web UI Routes
```
/web
โโโ / - ะณะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ
โโโ /prediction-history - ะธััะพัะธั ะฟัะตะดัะบะฐะทะฐะฝะธะน
โโโ /transaction-history - ะธััะพัะธั ััะฐะฝะทะฐะบัะธะน
```

## ๐ RPC Communication

### RabbitMQ RPC Pattern
```python
# ะะปะธะตะฝั (FastAPI)
response = ml_service_rpc.call(message)

# ะกะตัะฒะตั (ML Worker)
def on_request(ch, method, props, body):
    # ะะฑัะฐะฑะพัะบะฐ ะทะฐะฟัะพัะฐ
    # ะะตะฝะตัะฐัะธั ัะผะฑะตะดะดะธะฝะณะฐ
    # ะะพะทะฒัะฐั ัะตะทัะปััะฐัะฐ
```

### Message Format
```json
{
  "text": "ัะตะบัั ะทะฐะฟัะพัะฐ ะฟะพะปัะทะพะฒะฐัะตะปั",
  "timestamp": "2025-08-19T12:00:00Z"
}
```

### Response Format
```json
{
  "request_embedding": [0.1, 0.2, ...],
  "processing_time": 0.15,
  "model_version": "all-MiniLM-L6-v2"
}
```

## ๐ ะะฐัััะฐะฑะธััะตะผะพััั

### ะะพัะธะทะพะฝัะฐะปัะฝะพะต ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะต
- **FastAPI**: ะะฝะพะถะตััะฒะพ ัะบะทะตะผะฟะปััะพะฒ ะทะฐ Nginx
- **ML Worker**: ะะตัะบะพะปัะบะพ ะฒะพัะบะตัะพะฒ ะดะปั ะฟะฐัะฐะปะปะตะปัะฝะพะน ะพะฑัะฐะฑะพัะบะธ
- **Database**: Read replicas ะดะปั ะทะฐะฟัะพัะพะฒ

### ะะตััะธะบะฐะปัะฝะพะต ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะต
- ะฃะฒะตะปะธัะตะฝะธะต ัะตััััะพะฒ ะบะพะฝัะตะนะฝะตัะพะฒ
- ะะฟัะธะผะธะทะฐัะธั ะทะฐะฟัะพัะพะฒ ะบ ะฑะฐะทะต ะดะฐะฝะฝัั
- ะััะธัะพะฒะฐะฝะธะต ัะตะทัะปััะฐัะพะฒ ML ะผะพะดะตะปะธ

## ๐ ะะพะฝะธัะพัะธะฝะณ ะธ ะปะพะณะธัะพะฒะฐะฝะธะต

### ะะพะณะธัะพะฒะฐะฝะธะต
- **Structured logging** ัะตัะตะท Loguru
- **Security logging** ะดะปั ะพััะปะตะถะธะฒะฐะฝะธั ะดะพัััะฟะฐ
- **Performance monitoring** ะดะปั ะผะตััะธะบ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

### ะะตััะธะบะธ
- ะัะตะผั ะพัะฒะตัะฐ API
- ะะพะปะธัะตััะฒะพ ะทะฐะฟัะพัะพะฒ
- ะัะฟะพะปัะทะพะฒะฐะฝะธะต ัะตััััะพะฒ
- ะกัะฐัะธััะธะบะฐ ML ะผะพะดะตะปะธ

## ๐๏ธ ะะฐะทะฒะตัััะฒะฐะฝะธะต

### Docker Compose
```yaml
services:
  app:
    build: ./app
    depends_on:
      - database
      - rabbitmq
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health')"]
  
  ml_worker:
    build: ./ml_worker
    depends_on:
      - rabbitmq
  
  database:
    image: ankane/pgvector:v0.5.1
    environment:
      POSTGRES_DB: movie_recommender
  
  rabbitmq:
    image: rabbitmq:3.13.1-management-alpine
    ports:
      - "5672:5672"
      - "15672:15672"
  
  web-proxy:
    build: ./nginx
    depends_on:
      app:
        condition: service_healthy
```

### Environment Variables
- **app/.env**: ะะฐัััะพะนะบะธ ะพัะฝะพะฒะฝะพะณะพ ะฟัะธะปะพะถะตะฝะธั
- **ml_worker/.env**: ะะฐัััะพะนะบะธ ML ัะตัะฒะธัะฐ
- **docker-compose.yaml**: ะะฑัะธะต ะฝะฐัััะพะนะบะธ

## ๐ฎ ะัะดััะธะต ัะปัััะตะฝะธั

### ะัะฐัะบะพััะพัะฝัะต
- ะะตัะตัะพะด ะฝะฐ JWT ัะพะบะตะฝั
- ะะพะฑะฐะฒะปะตะฝะธะต HTTPS
- ะฃะปัััะตะฝะฝัะน ะผะพะฝะธัะพัะธะฝะณ

### ะกัะตะดะฝะตััะพัะฝัะต
- GraphQL API
- ะะธะบัะพัะตัะฒะธัะฝะฐั ะฐััะธัะตะบัััะฐ
- Kubernetes ัะฐะทะฒะตัััะฒะฐะฝะธะต

### ะะพะปะณะพััะพัะฝัะต
- AI-powered ัะตะบะพะผะตะฝะดะฐัะธะธ
- ะัะปััะธะผะพะดะฐะปัะฝัะต ัะผะฑะตะดะดะธะฝะณะธ
- Real-time ะพะฑะฝะพะฒะปะตะฝะธั

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะตััััั

- [README.md](README.md) - ะะฑัะตะต ะพะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ
- [SECURITY_RECOMMENDATIONS.md](SECURITY_RECOMMENDATIONS.md) - ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ะฑะตะทะพะฟะฐัะฝะพััะธ
- [app/data/README.md](app/data/README.md) - ะะฟะธัะฐะฝะธะต ะดะฐะฝะฝัั ัะธะปัะผะพะฒ
